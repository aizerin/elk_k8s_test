---
{{- if .Values.kibana.enabled }}
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: {{ .Values.kibana.name }}
  labels:
    {{- include "kibana.labels" . | nindent 4 }}
  annotations:
    eck.k8s.elastic.co/license: basic
spec:
  version: {{ .Values.clusterVersion }}
  count: {{ .Values.kibana.count }}
  # TODO checeme mit ten apm central config ?
  config:
    xpack.fleet.packages:
    - name: apm
      version: latest
  elasticsearchRef:
    name: {{ .Values.elasticsearch.name }}
  monitoring:
    metrics:
      elasticsearchRefs:
        - name: {{ .Values.elasticsearch.name }}
    logs:
      elasticsearchRefs:
        - name: {{ .Values.elasticsearch.name }}
      # TODO bez tohodle mne nefunguje trafik routovani. takhle ta kibana je na http
  http:
    tls:
      selfSignedCertificate:
        disabled: true
{{- end }}